#!/bin/bash

trap "echo -e '\nCaught ^C from user - exiting now' ; exit 130" SIGINT

eval_brew() {
  if [[ -x "/opt/homebrew/bin/brew" ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [[ -x "/usr/local/bin/brew" ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
  elif [[ -x "/home/linuxbrew/.linuxbrew/bin/brew" ]]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  elif [[ -x "$HOME/.linuxbrew/bin/brew" ]]; then
    eval "$("$HOME"/.linuxbrew/bin/brew shellenv)"
  fi
}
eval_brew

if ! command -v brew >/dev/null; then
  NONINTERACTIVE=true bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  eval_brew
fi

### Homebrew core ##############################################################

brew install bat                                                        # rust
brew install btop                                                       # c++
brew install fd                                                         # rust
brew install fzf && yes | "$(brew --prefix fzf)/install" --no-update-rc # go
brew install gitui                                                      # rust
brew install grex                                                       # rust
brew install jq                                                         # c
brew install kalker                                                     # rust
brew install lsd                                                        # rust
brew install procs                                                      # rust
brew install ripgrep                                                    # rust
brew install sd                                                         # rust
brew install starship                                                   # rust
brew install watch                                                      # c
brew install xh                                                         # rust
brew install zoxide                                                     # rust

### macOS only brews ###########################################################

if [[ $OSTYPE == darwin* ]]; then
  # The logfile navigator (https://github.com/tstack/lnav)
  brew install lnav

  # Swiss Army Knife for macOS (https://github.com/rgcr/m-cli)
  brew install m-cli

  # https://github.com/lavoiesl/osx-cpu-temp
  brew install osx-cpu-temp

  # Xcode Commandline Tools provides old git
  brew install git

  # GNU utils are g-prefixed (non-g symlinks are prepended to PATH in .profile)
  brew install coreutils
  brew install findutils
  #brew install gnu-getopt
  #brew install gnu-indent
  #brew install gnu-sed
  #brew install gnu-tar
  #brew install gnu-time
  #brew install gnu-which
  brew install grep
fi
