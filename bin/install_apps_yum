#!/bin/sh

trap "printf '\nCaught ^C from user - exiting now' ; exit 130" INT

if [ "$(id -u)" = 0 ]; then
    SUDO=''
elif which sudo >/dev/null 2>&1 ; then
    SUDO='sudo'

    # Ask sudo password upfront
    sudo -v

    # Keep sudo alive until the script has finished
    while true; do
      sudo -n true
      sleep 60
      kill -0 "$$" || exit
    done 2>/dev/null &
else
    printf "\nERROR: User is non-root and sudo not available, cannot proceed.\n"
    exit 1
fi

# Update package lists
$SUDO yum check-update -y

# Add Epel repostitory
$SUDO yum install -y epel-release

# Certificates
$SUDO yum install -y ca-certificates 

# Cryptography
$SUDO yum install -y gnupg

# Common build requirements
$SUDO yum install -y gcc gcc-c++ make \
  openssl-devel readline-devel sqlite-devel bzip2-devel zlib-devel libffi-devel

# Utils
$SUDO yum install -y bash coreutils bind-utils file findutils \
  git htop redhat-lsb-core procps traceroute zip unzip wget whois

# pbcopy/pbpaste like experience
#$SUDO yum install -y xsel

# Microsoft TrueType fonts (accepts EULA)
#$SUDO yum install -y cabextract fontconfig xorg-x11-font-utils
#$SUDO rpm -i https://downloads.sourceforge.net/project/mscorefonts2/rpms/msttcore-fonts-installer-2.6-1.noarch.rpm

# Docker (rootless)
$SUDO yum install -y fuse-overlayfs iptables dbus-daemon
curl -fsSL https://get.docker.com/rootless | sh
systemctl --user start dbus
systemctl --user start docker
$SUDO loginctl enable-linger "$USER"

# Snap
$SUDO yum install -y fuse squashfuse # docker requirement for snap
$SUDO yum install -y kernel-modules # VM requirement for snap
$SUDO yum install -y snapd
$SUDO ln -s /var/lib/snapd/snap /snap
