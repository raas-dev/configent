#!/bin/bash

trap "echo -e '\nCaught ^C from user - exiting now' ; exit 130" SIGINT

eval_brew() {
  if [[ -x "/opt/homebrew/bin/brew" ]]; then
      eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [[ -x "/usr/local/bin/brew" ]]; then
      eval "$(/usr/local/bin/brew shellenv)"
  elif [[ -x "/home/linuxbrew/.linuxbrew/bin/brew" ]]; then
      eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  elif [[ -x "$HOME/.linuxbrew/bin/brew" ]]; then
      eval "$("$HOME"/.linuxbrew/bin/brew shellenv)"
  fi
}
eval_brew

if ! which brew &>/dev/null ; then
  NONINTERACTIVE=true bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  eval_brew
fi

brew install neovim

### Symlink Neovim configs #####################################################

mkdir -p "$HOME/.config"
ln -sf "$HOME/.vim" "$HOME/.config/nvim"
ln -sf "$HOME/.vimrc" "$HOME/.config/nvim/init.vim"

### Install Vundle #############################################################

vundle_dir="$HOME/.vim/bundle/Vundle.vim"
git clone https://github.com/VundleVim/Vundle.vim.git "$vundle_dir" || \
  git -C "$vundle_dir" pull --rebase

echo -ne '\n' | nvim +PluginInstall +qall 2>/dev/null
